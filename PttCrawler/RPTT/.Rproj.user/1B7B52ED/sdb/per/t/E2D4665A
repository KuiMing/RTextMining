{
    "contents" : "\nlibrary(httr)\nlibrary(CSS)\n\n####################################################\n# getListPageUrls via boardName\n####################################################\n\ngetListPageUrls = function(boardName){  \n  # function input: boardName\n  # boardName = \"Gossiping\"\n  \n  boardUrl = sprintf(\"https://www.ptt.cc/bbs/%s/index.html\",boardName)\n  res <- GET(boardUrl,set_cookies(over18=1))\n  node = content(res, encoding = \"utf8\")\n  \n  node[cssToXpath(\"div.btn-group.pull-right > a\")]\n  maxPage = as.numeric(gsub(\".html\",\"\",unlist(strsplit(xmlAttrs(node[cssToXpath(\"div.btn-group.pull-right > a\")][[2]])[\"href\"],split = \"index\"))[2]))\n  \n  allListPages = c(\"\",1:maxPage)\n  allListUrls = sapply(allListPages,function(page){\n    sprintf(\"https://www.ptt.cc/bbs/%s/index%s.html\",boardName,page)\n  })\n  # function output: allListUrls\n  allListUrls\n  \n}\n\n\n####################################################\n# getPostUrls via listPageUrl\n####################################################\n\ngetPostUrls = function(listPageUrl){\n  # function input: listPageUrl\n  # listPageUrl = allListUrls[10]\n  \n  res <- GET(listPageUrl,set_cookies(over18=1))\n  node = content(res, encoding = \"utf8\")\n  node[cssToXpath(\".title a\")]\n  postUrls = cssApply(node,\".title a\",function(node){\n    sprintf(\"https://www.ptt.cc%s\",xmlAttrs(node)[\"href\"])\n  })\n  # function output: postUrls\n  postUrls\n  \n}\n\n####################################################\n# getPostData via postUrl\n####################################################\n\ngetPostData = function(postUrl){\n  # function input: postUrl\n  # postUrl <- \"https://www.ptt.cc/bbs/Gossiping/M.1431338763.A.1BF.html\"\n  res <- GET(postUrl,set_cookies(over18=1))\n  node = content(res, encoding = \"utf8\")\n  \n  postData = list()\n  postData$Board = cssApply(node,\".article-metaline-right > .article-meta-value\",cssCharacter)\n  \n  metaTemp = cssApply(node,\".article-metaline > .article-meta-value\",cssCharacter)\n  \n  postData$Author = metaTemp[1]\n  postData$Title = metaTemp[2]\n  postData$Time = metaTemp[3]\n  \n  removeNodes(node[cssToXpath(\".article-metaline-right > .article-meta-value\")])\n  removeNodes(node[cssToXpath(\".article-metaline > .article-meta-value\")])\n  \n  postData$Text = xmlValue(node[cssToXpath(\"#main-content\")][[1]])\n  \n  postData$postUrl = postUrl\n  postData$postId = gsub(\"[/]|.html\",\"\",unlist(strsplit(postUrl,postData$Board))[2])\n  \n  pustData = lapply(node[cssToXpath(\"div.push\")],function(test){\n    list(pushTag=xmlValue(test[\"span\"][[1]]),\n         userId=xmlValue(test[\"span\"][[2]]),\n         text=xmlValue(test[\"span\"][[3]]),\n         time=xmlValue(test[\"span\"][[4]]))\n  })\n  \n  \n  pushDf = data.frame(postId = postData$postId,\n                      postUrl = postUrl,\n                      do.call(rbind,pustData),stringsAsFactors = FALSE)\n  \n  # function output: \n  list(postData=postData,pushDf=pushDf)\n    \n} \n\n",
    "created" : 1431440600741.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "432081221",
    "id" : "E2D4665A",
    "lastKnownWriteTime" : 1431438979,
    "path" : "/project/CaseStudies/Case6PttGossiping/packIntoFunction.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}